# ğŸš€ Prek - Configuration Pre-commit

Ce projet utilise [prek](https://prek.j178.dev/), une implÃ©mentation ultra-rapide de pre-commit Ã©crite en Rust.

## ğŸ“¦ Installation

Les hooks sont automatiquement installÃ©s lors du `make setup`. Pour une installation manuelle :

```bash
uv run prek install
```

## ğŸ¯ Commandes utiles

### ExÃ©cuter tous les hooks

```bash
# Sur tous les fichiers
uv run prek run --all-files

# Sur les fichiers modifiÃ©s uniquement
uv run prek run
```

### ExÃ©cuter un hook spÃ©cifique

```bash
# Lister tous les hooks disponibles
uv run prek list

# ExÃ©cuter un hook spÃ©cifique
uv run prek run ruff
uv run prek run ty-check
uv run prek run eslint-next
```

### ExÃ©cuter plusieurs hooks

```bash
uv run prek run ruff ruff-format ty-check
```

### ExÃ©cuter sur un rÃ©pertoire spÃ©cifique

```bash
# Uniquement les fichiers dans apps/server
uv run prek run --directory apps/server
```

### Skip des hooks temporairement

```bash
# Skip un ou plusieurs hooks
PREK_SKIP=ty-check,eslint-next git commit -m "WIP"

# Bypass tous les hooks (Ã  Ã©viter)
git commit --no-verify -m "emergency fix"
```

### Mise Ã  jour des hooks

```bash
# Mettre Ã  jour tous les hooks vers leur derniÃ¨re version
uv run prek auto-update

# Avec un dÃ©lai de sÃ©curitÃ© (recommandÃ© pour Ã©viter les attaques supply chain)
uv run prek auto-update --cooldown-days 7
```

## ğŸ”§ Hooks configurÃ©s

### Built-in (Rust natif - ultra rapide)

- âœ‚ï¸ `trailing-whitespace` - Supprime les espaces en fin de ligne
- ğŸ”š `end-of-file-fixer` - Ajoute une ligne vide en fin de fichier
- ğŸ” `check-yaml` - Valide les fichiers YAML
- ğŸ” `check-json` - Valide les fichiers JSON
- ğŸ” `check-toml` - Valide les fichiers TOML
- ğŸš« `check-added-large-files` - EmpÃªche l'ajout de fichiers > 1MB
- ğŸ” `check-merge-conflict` - DÃ©tecte les marqueurs de conflit git
- ğŸ” `detect-private-key` - DÃ©tecte les clÃ©s privÃ©es
- ğŸ” `check-case-conflict` - DÃ©tecte les conflits de casse (insensible sur macOS)
- ğŸ” `mixed-line-ending` - Normalise les fins de ligne (LF)

### Python (Backend - apps/server)

- ğŸ `ruff` - Lint Python (remplace flake8, isort, etc.)
- ğŸ `ruff-format` - Format Python (remplace black)
- ğŸ” `ty-check` - Type checking Python (ultra rapide)

### JavaScript/TypeScript (Frontend)

- ğŸ” `eslint-next` - Lint Next.js (apps/next)
- ğŸ” `eslint-vue` - Lint Vue.js (apps/vue)

### Docker

- ğŸ³ `hadolint-docker` - Lint Dockerfiles

### Documentation

- ğŸ” `python-check-blanket-noqa` - VÃ©rifie les noqa sans code d'erreur
- ğŸ” `python-check-blanket-type-ignore` - VÃ©rifie les type:ignore sans code

## âš¡ PrioritÃ©s et parallÃ©lisme

Les hooks sont organisÃ©s par prioritÃ© :

- **Priority 0** : Hooks rapides (built-in) - s'exÃ©cutent en parallÃ¨le
- **Priority 10** : Lint & format (Python, JS, Docker) - s'exÃ©cutent en parallÃ¨le
- **Priority 20** : Type checking (ty) - s'exÃ©cute aprÃ¨s le lint

Les hooks avec la mÃªme prioritÃ© s'exÃ©cutent en parallÃ¨le (jusqu'Ã  `N_CPU` threads).

## ğŸ› DÃ©bogage

```bash
# DÃ©sactiver le fast path (utiliser les implÃ©mentations originales)
PREK_NO_FAST_PATH=1 uv run prek run

# DÃ©sactiver le parallÃ©lisme
PREK_NO_CONCURRENCY=1 uv run prek run

# Mode verbose
uv run prek run -v
```

## ğŸ“ IntÃ©gration CI

Les hooks sont Ã©galement exÃ©cutÃ©s dans GitHub Actions (voir `.github/workflows/lint.yml`).

## ğŸ”— Resources

- Documentation officielle : https://prek.j178.dev/
- Repository : https://github.com/j178/prek
- Configuration : [.pre-commit-config.yaml](.pre-commit-config.yaml)
